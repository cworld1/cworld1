{"title":"利用腾讯云无服务器云函数搭建 OneDrive 网盘","date":"2020-02-13T08:44:58.000Z","date_formatted":{"ll":"2020年2月13日","L":"2020/02/13","MM-DD":"02-13"},"thumbnail":"https://tva1.sinaimg.cn/large/0060ksKkly1gbuhc4an2fj319c0a5gm2.jpg","color":"#006fff","link":"post/onedrive-scf","comments":true,"tags":["Onedrive"],"categories":["教程"],"updated":"2022-11-30T12:42:15.393Z","content":"<p>原理是用腾讯云的无服务器云函数配合 API 网关实现，不需要自己的服务器。</p>\n<span id=\"more\"></span>\n<p>零成本搭建，实测运行机器的配置，8 核 16G 内存（可以运行 System 命令链接 Shell 看），因此此方法搭建自己的大型网站完全够用。</p>\n<p>腾讯云无服务器云函数（Serverless Cloud Function，SCF）是腾讯云为企业和开发者们提供的无服务器执行环境，帮助您在无需购买和管理服务器的情况下运行代码。您只需使用平台支持的语言编写核心代码并设置代码运行的条件，即可在腾讯云基础设施上弹性、安全地运行代码。SCF 是实时文件处理和数据处理等场景下理想的计算平台。</p>\n<h2 id=\"准备\">准备<a title=\"#准备\" href=\"#准备\"></a></h2>\n<ul>\n<li>\n<p>OneDrive SCF 源码</p>\n<p>这里给出仓库地址：</p>\n<p>最初版本 <a href=\"https://github.com/Tai7sy/OneDrive_SCF\" target=\"_blank\">OneDrive_SCF</a></p>\n<p>第二版本 <a href=\"https://github.com/qkqpttgf/OneDrive_SCF\" target=\"_blank\">OneDrive_SCF</a></p>\n<p>三合一版本 <a href=\"https://github.com/qkqpttgf/OneManager-php\" target=\"_blank\">OneManager-php</a></p>\n</li>\n<li>\n<p>一个 OneDrive 账号</p>\n<p>如果你想拥有一个不限量空间，可以尝试在网上找子账号，或者自己申请 <a href=\"https://baijiahao.baidu.com/s?id=1655579024801979058\" target=\"_blank\">Office 365 E5 管理</a></p>\n</li>\n<li>\n<p>一个腾讯云账号</p>\n</li>\n</ul>\n<h2 id=\"提要\">提要<a title=\"#提要\" href=\"#提要\"></a></h2>\n<ul>\n<li>腾讯云的 API 网关还可以关联上自己的域名，从而脱离本身的随机域名。</li>\n<li>如果你是 Office 365 E5 管理员并准备 90 天续期，或许这个可以帮助你长期保持活跃状态。</li>\n</ul>\n<h2 id=\"注意事项\">注意事项<a title=\"#注意事项\" href=\"#注意事项\"></a></h2>\n<p>API 网关从 2019 年 12 月 4 日开始收费。请注意不要超过额度，这意味着最好不要将网站随意告诉他人，以免恶意刷流量。当然腾讯云的免费额度对于个人来说完全够用，超出后收费也非常亲民。所以最好是在腾讯云上充值一块钱，以免意外超额。</p>\n<p>仅调用云函数会收费，因此查看文件的文件本身和下载仅消耗微软的免费服务，因此不会有任何费用产生。</p>\n<p><a href=\"https://cloud.tencent.com/document/product/583/12282\" target=\"_blank\">腾讯云免费额度</a></p>\n<p><a href=\"https://cloud.tencent.com/document/product/583/12284\" target=\"_blank\">GBs 单位与费用计算</a></p>\n<p><a href=\"https://cloud.tencent.com/document/product/583/12281\" target=\"_blank\">超出免费额度收费标准</a></p>\n<p>如果上述内容有些生涩难懂，可以配合 <a href=\"https://cloud.tencent.com/document/product/583/12285\" target=\"_blank\">腾讯云函数计费示例</a> 一同查看。</p>\n<h2 id=\"搭建教程\">搭建教程<a title=\"#搭建教程\" href=\"#搭建教程\"></a></h2>\n<p>开发者也很贴心地制作了视频。<a href=\"https://service-pgxgvop2-1258064400.ap-hongkong.apigateway.myqcloud.com/test/abcdef/%E6%97%A0%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%87%BD%E6%95%B0SCF%E6%90%AD%E5%BB%BAOneDrive.mp4?preview\" target=\"_blank\">点击查看</a> 可以与此教程互相对照。</p>\n<ol>\n<li>\n<p>打开进入腾讯云 SCF。</p>\n<p><img src=\"https://tvax2.sinaimg.cn/large/0060ksKkly1gbuiu6ay46j30i2081q37.jpg\" alt=\"腾讯云 SCF\" loading=\"lazy\" class=\"φbp\"></p>\n</li>\n<li>\n<p>函数服务-新建函数-空白函数</p>\n<blockquote>\n<p>后面如果想绑定自定义域名，只能绑定备案域名，所以刚开始新建函数的时候，我们最好选择香港地区，即从下图中的广州改为香港。<br>\n<img src=\"https://tvax2.sinaimg.cn/large/0060ksKkly1gbuivuzqnqj30hl0a6t8v.jpg\" alt=\"新建函数\" loading=\"lazy\"></p>\n</blockquote>\n<p>模板选择空白。填写函数名称，注意以后会以这个名称将作网址且难以更改。运行环境选 PHP7.2。<br>\n<img src=\"https://tvax2.sinaimg.cn/large/0060ksKkly1gbukixrkfdj30g70cgdfx.jpg\" alt=\"模板选择\" loading=\"lazy\"></p>\n</li>\n<li>\n<p>函数配置</p>\n<p>可以修改一下描述，提交方式选择本地上传。</p>\n</li>\n<li>\n<p>下载函数源码并上传</p>\n<p>下载源码：<a href=\"https://sword.studio/go/aHR0cHM6Ly9naXRodWIuY29tL1RhaTdzeS9PbmVEcml2ZV9TQ0YvYXJjaGl2ZS9tYXN0ZXIuemlw\" target=\"_blank\">点击下载</a></p>\n<p><img src=\"https://tvax4.sinaimg.cn/large/0060ksKkly1gbukrik5xxj30i80d4dhn.jpg\" alt=\"选择\" loading=\"lazy\" class=\"φbp\"></p>\n<blockquote>\n<p>博主在上传的时候因为是手机操作，所以先使用了压缩包的形式，结果提示错误。所以这里可能只能选择文件夹上传。</p>\n</blockquote>\n</li>\n<li>\n<p>添加触发方式</p>\n<p>修改触发方式，开启集成响应。</p>\n<p><img src=\"https://tva3.sinaimg.cn/large/0060ksKkly1gbukx28f6fj30uz0l5n1l.jpg\" alt=\"2020-2-13 10-46-33\" loading=\"lazy\" class=\"φbp\"></p>\n</li>\n<li>\n<p>进入网站，添加 API 密钥</p>\n<p><img src=\"https://tvax1.sinaimg.cn/large/0060ksKkly1gbul0sz311j30sc0cxq5b.jpg\" alt=\"2020-2-13 10-49-26\" loading=\"lazy\" class=\"φbp\"></p>\n<p>选择中文，开始新建</p>\n<p><img src=\"https://tvax2.sinaimg.cn/large/0060ksKkly1gbul29qzlgj30jo0ci0ty.jpg\" alt=\"2020-2-13 10-49-39\" loading=\"lazy\" class=\"φbp\"></p>\n<p>接下来的窗口选择继续，然后新建密钥。</p>\n<p>回到函数配置，点击右上角的编辑，将获取的密钥粘贴入环境变量中。</p>\n<p><img src=\"https://tva3.sinaimg.cn/large/0060ksKkly1gbul5zj6c3j313t0oagp4.jpg\" alt=\"2020-2-13 10-55-18\" loading=\"lazy\" class=\"φbp\"></p>\n<p><img src=\"https://tva1.sinaimg.cn/large/0060ksKkly1gbul8tl7f4j30om0he405.jpg\" alt=\"2020-2-13 10-56-53\" loading=\"lazy\" class=\"φbp\"></p>\n</li>\n<li>\n<p>完成配置</p>\n<p>回到之前自己建的网站，如果没有错就可以继续下一步。选择 MS 默认。</p>\n<p>接下来会自动跳转到 OneDrive ，选择登录并继续，即可看到配置成功的界面。</p>\n<p><img src=\"https://tva3.sinaimg.cn/large/0060ksKkly1gbuli0z99vj31410o7790.jpg\" alt=\"2020-2-13 11-6-41\" loading=\"lazy\" class=\"φbp\"></p>\n<p>回到函数配置，点击右上角的编辑，环境变量中继续添加：key 为 admin ，value 为你要设置的密码。</p>\n<p><img src=\"https://tva1.sinaimg.cn/large/0060ksKkly1gbuliziisyj30lb0cc0tn.jpg\" alt=\"2020-2-13 11-7-54\" loading=\"lazy\" class=\"φbp\"></p>\n<p>回到网址，刷新后左上角就可以登录进入后台了。点击更新并在下方进行相应配置。这样就基本完工了！</p>\n</li>\n</ol>\n<h2 id=\"定义域名\">定义域名<a title=\"#定义域名\" href=\"#定义域名\"></a></h2>\n<p>回到 API 网关，选择自定义域名，新建</p>\n<p>为了得到最简链接，自定义路径设为 <code>/</code> <code>发布</code></p>\n<p><img src=\"https://tvax4.sinaimg.cn/large/0060ksKkly1gbums87xr6j30q30hkjrv.jpg\" alt=\"2020-2-13 11-51-2\" loading=\"lazy\" class=\"φbp\"></p>\n<blockquote>\n<p>如果需要 https，点击“点此前往”，然后点击申请免费证书。注意证书和域名自定义都需要添加解析。<br>\n<img src=\"https://tva4.sinaimg.cn/large/0060ksKkly1gbun91d7xwj31an03kjre.jpg\" alt=\"2020-2-13 12-7-30\" loading=\"lazy\"></p>\n</blockquote>\n<p>添加蓝色提示框内的网站为 CNAME 解析。</p>\n<p>访问链接即更换为：<a href=\"https://%60%E4%BD%A0%E8%87%AA%E5%B7%B1%E8%AE%BE%E7%BD%AE%E7%9A%84%E5%9F%9F%E5%90%8D%60/%60%E5%87%BD%E6%95%B0%E5%90%8D%60\" target=\"_blank\">https://`你自己设置的域名`/`函数名`</a></p>\n<h2 id=\"进阶域名\">进阶域名<a title=\"#进阶域名\" href=\"#进阶域名\"></a></h2>\n<p>最近腾讯改进出了更完美的方案，可以将上述的“/<code>函数名</code>”也去掉了。</p>\n<p>作者发的视频链接：<a href=\"https://service-pgxgvop2-1258064400.ap-hongkong.apigateway.myqcloud.com/test/abcdef/%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9F%9F%E5%90%8D%E5%8F%8A%E5%85%B6%E5%AE%83%E8%AE%BE%E7%BD%AE.mp4?preview\" target=\"_blank\">使用自定义域名及其它设置</a></p>\n<p>找到下图，点击服务名链接。</p>\n<p><img src=\"https://tvax1.sinaimg.cn/large/0060ksKkly1gc2pstaum5j30al07qgll.jpg\" alt=\"image\" loading=\"lazy\" class=\"φbp\"></p>\n<p>选择管理 API，点击右侧的编辑。</p>\n<p><img src=\"https://tva3.sinaimg.cn/large/0060ksKkly1gc2q19mjq8j318c09udgh.jpg\" alt=\"image\" loading=\"lazy\" class=\"φbp\"></p>\n<p>将路径改为“/”，点击下一步直到完成即可。然后根据提示点击发布。</p>\n<p><img src=\"https://tva3.sinaimg.cn/large/0060ksKkly1gc2raxninpj30dz0adaal.jpg\" alt=\"image\" loading=\"lazy\" class=\"φbp\"></p>\n<p><img src=\"https://tvax2.sinaimg.cn/large/0060ksKkly1gc2rdybj76j30l40d10sr.jpg\" alt=\"image\" loading=\"lazy\" class=\"φbp\"></p>\n<p>（看起来很像 git 代码托管平台的步骤）</p>\n<p><img src=\"https://tva3.sinaimg.cn/large/0060ksKkly1gc2resp4goj30hx0claab.jpg\" alt=\"image\" loading=\"lazy\" class=\"φbp\"></p>\n<p>这时访问链接也终于更换为：<a href=\"https://%60%E4%BD%A0%E8%87%AA%E5%B7%B1%E8%AE%BE%E7%BD%AE%E7%9A%84%E5%9F%9F%E5%90%8D%60\" target=\"_blank\">https://`你自己设置的域名`</a></p>\n<h2 id=\"进阶美化\">进阶美化<a title=\"#进阶美化\" href=\"#进阶美化\"></a></h2>\n<p>截图：</p>\n<p><img src=\"https://tva1.sinaimg.cn/large/0060ksKkly1gbum1csl5aj30or0gzgna.jpg\" alt=\"2020-2-13 11-23-49\" loading=\"lazy\" class=\"φbp\"></p>\n<p><img src=\"https://tvax4.sinaimg.cn/large/0060ksKkly1gbum1w8ap7j30g50afaad.jpg\" alt=\"2020-2-13 11-24-34\" loading=\"lazy\" class=\"φbp\"></p>\n<p><img src=\"https://tvax2.sinaimg.cn/large/0060ksKkly1gbum28xu35j30ok0ddabj.jpg\" alt=\"2020-2-13 11-25-11\" loading=\"lazy\" class=\"φbp\"></p>\n<p>以下美化仅适用于 classic 主题。</p>\n<blockquote>\n<p><strong>日志</strong><br>\n设置界面失效。还未修复。</p>\n</blockquote>\n<p>腾讯云的函数界面中找到函数代码，下方窗口中选择 theme 文件夹的 classic.php 。找到<code>&lt;/head&gt;</code>前的<code>&lt;/style&gt;</code>，在这行前面追加以下代码。然后点击保存即可。</p>\n<p><img src=\"https://tvax4.sinaimg.cn/large/0060ksKkly1gbulr9zy8uj30ei0c0aan.jpg\" alt=\"2020-2-13 11-15-49\" loading=\"lazy\" class=\"φbp\"></p>\n<p>代码：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">body</span>&#123;<span class=\"attribute\">background</span>:<span class=\"built_in\">url</span>(<span class=\"string\">//tvax1.sinaimg.cn/large/0060ksKkly1gbs5b1as5ej31z4140wj0.jpg</span>) <span class=\"meta\">!important</span>;<span class=\"attribute\">color</span>:<span class=\"number\">#000</span>;<span class=\"attribute\">font-family</span>:Google Sans <span class=\"meta\">!important</span>;&#125;<span class=\"attribute\">font</span>&#123;<span class=\"attribute\">margin</span>:<span class=\"number\">39.5%</span>;<span class=\"attribute\">color</span>:<span class=\"number\">#989898</span>;<span class=\"attribute\">text-align</span>:center;&#125;<span class=\"selector-tag\">a</span><span class=\"selector-class\">.login</span>,<span class=\"selector-tag\">body</span>&gt;<span class=\"selector-tag\">div</span>&gt;<span class=\"selector-tag\">li</span><span class=\"selector-class\">.operate</span>&#123;<span class=\"attribute\">transition</span>:.<span class=\"number\">3s</span>;…<span class=\"selector-tag\">input</span><span class=\"selector-id\">#upload_submit</span>&#123;<span class=\"attribute\">transition</span>:.<span class=\"number\">3s</span>;<span class=\"attribute\">border</span>:none;<span class=\"attribute\">border-radius</span>:<span class=\"number\">4px</span>;<span class=\"attribute\">background</span>:<span class=\"number\">#0000000d</span>;<span class=\"attribute\">padding</span>:<span class=\"number\">8px</span> <span class=\"number\">11px</span>;<span class=\"attribute\">outline</span>:none <span class=\"meta\">!important</span>;&#125;<span class=\"selector-tag\">input</span><span class=\"selector-id\">#upload_submit</span><span class=\"selector-pseudo\">:hover</span>&#123;<span class=\"attribute\">background</span>:<span class=\"number\">#0088ff2e</span>;<span class=\"attribute\">color</span>:<span class=\"number\">#08f</span>;&#125;<span class=\"selector-tag\">form</span><span class=\"selector-attr\">[method=<span class=\"string\">&quot;post&quot;</span>]</span> <span class=\"selector-tag\">table</span>&#123;<span class=\"attribute\">background</span>:<span class=\"number\">#ffffffb5</span>;<span class=\"attribute\">border-radius</span>:<span class=\"number\">4px</span>;<span class=\"attribute\">border</span>:none;<span class=\"attribute\">padding</span>:<span class=\"number\">10px</span>;<span class=\"attribute\">border-spacing</span>:<span class=\"number\">10px</span>;<span class=\"attribute\">margin-bottom</span>:<span class=\"number\">10px</span>;&#125;<span class=\"selector-tag\">form</span><span class=\"selector-attr\">[method=<span class=\"string\">&quot;post&quot;</span>]</span> <span class=\"selector-tag\">td</span>&#123;<span class=\"attribute\">border</span>:none;&#125;<span class=\"selector-tag\">form</span><span class=\"selector-attr\">[method=<span class=\"string\">&quot;post&quot;</span>]</span> <span class=\"selector-tag\">input</span>,<span class=\"selector-tag\">form</span><span class=\"selector-attr\">[method=<span class=\"string\">&quot;post&quot;</span>]</span> select&#123;<span class=\"attribute\">transition</span>:.<span class=\"number\">3s</span>;<span class=\"attribute\">border</span>:none;<span class=\"attribute\">border-radius</span>:<span class=\"number\">4px</span>;<span class=\"attribute\">background</span>:<span class=\"number\">#0000000d</span>;<span class=\"attribute\">padding</span>:<span class=\"number\">8px</span> <span class=\"number\">11px</span>;<span class=\"attribute\">outline</span>:none <span class=\"meta\">!important</span>;&#125;<span class=\"selector-tag\">form</span><span class=\"selector-attr\">[method=<span class=\"string\">&quot;post&quot;</span>]</span> <span class=\"selector-tag\">input</span><span class=\"selector-attr\">[value=<span class=\"string\">&quot;设置&quot;</span>]</span>&#123;<span class=\"attribute\">background</span>:<span class=\"number\">#0088ff2e</span>;<span class=\"attribute\">color</span>:<span class=\"number\">#08f</span>;&#125;</span><br></pre></td></tr></table></figure>\n","prev":{"title":"那些好用的前端 CDN 推荐","link":"post/free-cdn"},"next":{"title":"iChrome CSS 美化","link":"post/ichrome-css"},"plink":"https://blog.cworld.top/post/onedrive-scf/","toc":[{"id":"准备","title":"准备","index":"1"},{"id":"提要","title":"提要","index":"2"},{"id":"注意事项","title":"注意事项","index":"3"},{"id":"搭建教程","title":"搭建教程","index":"4"},{"id":"定义域名","title":"定义域名","index":"5"},{"id":"进阶域名","title":"进阶域名","index":"6"},{"id":"进阶美化","title":"进阶美化","index":"7"}],"reward":true,"copyright":{"updated":"2022年11月30日","author":"CWorld","link":"<a href=\"https://blog.cworld.top/post/onedrive-scf/\" title=\"利用腾讯云无服务器云函数搭建 OneDrive 网盘\">https://blog.cworld.top/post/onedrive-scf/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow noopener\" target=\"_blank\">CC BY-NC-ND 4.0</a>)"},"reading_time":"1704 字约 11 分钟"}